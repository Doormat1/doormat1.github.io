
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Circuit Symbols Bingo — Batch Generator</title>

  <!-- Your existing stylesheet -->
  <link rel="stylesheet" href="assets/css/styles.css" />

  <!-- Minimal local styles (optional; remove if your CSS already defines .grid/.tile/.container) -->
  <style>
    .cards-wrapper {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      margin-top: 1rem;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
      padding: 12px;
      color: #111; /* creates dark coloured text in the cards */
    }
    .card h2 {
      font-size: 1rem;
      margin: 0 0 8px 0;
    }
    /* If styles.css already sets .grid/.tile, you can delete this block */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }
    .tile {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 80px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fafafa;
      font-size: 0.95rem;
      text-align: center;
      padding: 8px;
    }
    .tile .label { line-height: 1.2; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="h1">Bingo Cards — Batch Generator</h1>
      <div class="controls">
        bingohome.html
          <button class="secondary">Back to landing</button>
        </a>

        <label for="inputCount" class="sr-only">Number of cards</label>
        <input id="inputCount" type="number" min="1" max="100" value="9" class="secondary"
               style="width: 8rem;" aria-label="Number of cards" />

        <button id="btn-generate" class="secondary">Generate cards</button>
        <button id="btn-download-pdf" class="secondary">Download all as PDF</button>
        <button id="btn-download-png" class="secondary">Download all as PNG (ZIP)</button>
        <button id="btn-reset" class="secondary" title="Clear all generated cards">Clear</button>
      </div>
    </div>

    <p class="footer">
      Enter how many 3×3 cards you need, click <em>Generate cards</em>, then download as PDF or PNGs.
    </p>

    <div id="cardsWrapper" class="cards-wrapper" aria-live="polite"></div>
  </div>

  <!-- Libraries (loaded with proper <script> tags) -->
  https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js</script>
  https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js</script>
  https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js</script>

  <!-- Page logic -->
  <script>
    // ----- 1) Symbols (replace with your actual circuit symbols or SVGs) -----
    const SYMBOLS = [
      'Resistor', 'Capacitor', 'Inductor', 'Diode', 'LED',
      'Battery', 'Switch', 'Lamp', 'Motor',
      'Fuse', 'Ground', 'Ammeter', 'Voltmeter', 'Thermistor',
      'LDR', 'Transistor (NPN)', 'Transistor (PNP)', 'Op Amp',
      'Transformer', 'Speaker', 'Microphone', 'Relay', 'Bridge Rectifier'
    ];
    function getSymbolHTML(symbol) {
      return `<span class="label">${symbol}</span>`;
    }

    // ----- 2) Helpers -----
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function sampleUnique(arr, k) {
      if (k > arr.length) throw new Error('Not enough unique symbols.');
      return shuffle(arr).slice(0, k);
    }
    function nextFrame() {
      return new Promise(r => requestAnimationFrame(() => r()));
    }

    // ----- 3) Build a 3×3 card -----
    function buildCardElement(index) {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-card-index', String(index));

      const title = document.createElement('h2');
      title.textContent = `Card ${index}`;
      card.appendChild(title);

      const grid = document.createElement('div');
      grid.className = 'grid';
      card.appendChild(grid);

      const selected = sampleUnique(SYMBOLS, 9);
      for (let i = 0; i < 9; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.setAttribute('data-symbol', selected[i]);
        tile.innerHTML = getSymbolHTML(selected[i]);
        grid.appendChild(tile);
      }
      return card;
    }

    // ----- 4) Generate multiple cards -----
    async function generateCards(count) {
      const wrapper = document.getElementById('cardsWrapper');
      wrapper.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        const card = buildCardElement(i);
        wrapper.appendChild(card);
        await nextFrame();
      }
    }

    // ----- 5) Download all as PDF -----
    async function downloadAllAsPdf() {
      const { jsPDF } = window.jspdf || {};
      if (!jsPDF) { alert('jsPDF failed to load.'); return; }

      const cards = Array.from(document.querySelectorAll('.card'));
      if (cards.length === 0) { alert('No cards to download.'); return; }

      const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();
      const margin = 10;
      const maxW = pageW - margin * 2;
      const maxH = pageH - margin * 2;

      for (let i = 0; i < cards.length; i++) {
        const canvas = await html2canvas(cards[i], { backgroundColor: '#ffffff', scale: 2 });
        const imgData = canvas.toDataURL('image/png');

        const pxW = canvas.width, pxH = canvas.height;
        const dpi = 96;
        const imgWmm = (pxW / dpi) * 25.4;
        const imgHmm = (pxH / dpi) * 25.4;
        const scale = Math.min(maxW / imgWmm, maxH / imgHmm);
        const drawW = imgWmm * scale;
        const drawH = imgHmm * scale;

        const x = (pageW - drawW) / 2;
        const y = (pageH - drawH) / 2;

        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, 'PNG', x, y, drawW, drawH);
      }
      pdf.save(`bingo-cards-${cards.length}.pdf`);
    }

    // ----- 6) Download PNGs in a ZIP -----
    async function downloadAllAsPngZip() {
      if (!window.JSZip) { alert('JSZip failed to load.'); return; }

      const cards = Array.from(document.querySelectorAll('.card'));
      if (cards.length === 0) { alert('No cards to download.'); return; }

      const zip = new JSZip();
      for (let i = 0; i < cards.length; i++) {
        const canvas = await html2canvas(cards[i], { backgroundColor: '#ffffff', scale: 2 });
        const dataUrl = canvas.toDataURL('image/png');
        const base64 = dataUrl.split(',')[1];
        zip.file(`bingo-card-${i + 1}.png`, base64, { base64: true });
      }

      const blob = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `bingo-cards-${cards.length}.zip`;
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      a.remove();
    }

    // ----- 7) Wire up buttons -----
    document.getElementById('btn-generate').addEventListener('click', async () => {
      const input = document.getElementById('inputCount');
      const val = Math.max(1, Math.min(100, parseInt(input.value, 10) || 1));
      await generateCards(val);
    });
    document.getElementById('btn-download-pdf').addEventListener('click', downloadAllAsPdf);
    document.getElementById('btn-download-png').addEventListener('click', downloadAllAsPngZip);
    document.getElementById('btn-reset').addEventListener('click', () => {
      document.getElementById('cardsWrapper').innerHTML = '';
    });

    // Generate default on load
    window.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('inputCount');
      generateCards(parseInt(input.value, 10) || 9);
    });
  </script>
</body>
